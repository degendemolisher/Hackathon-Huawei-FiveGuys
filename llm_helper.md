# Problem Formulation

## Decision-maker:
There is one decision-maker who is in charge of four data-centers.

## Data-centers (Table 1):
Each data-center has four attributes as listed in Table1.The data-center data can be found in the file “datacenters.csv”.

Attribute | Explanation | Variable
--- | --- | ---
Data-center ID | This is a unique data-center ID. | k
Cost of Energy | This is the electricity price per kilowatt per time-step. | h
Latency Sensitivity | This is the time it takes for data to travel from its source to the data-center and back. Latency sensitivity is divided into three categories: low, medium, and high. | i
Slots Capacity | A slot is a unit of space designed to hold a server in place. A server can occupy two or more slots. | V

## Servers (Table 2):
All data-centers can host a variety of servers. There are two types of servers: CPU, and GPU servers. As technology advances, new servers are available for purchase at certain time-steps. Each server has 12 attributes as listed in Table 2. The server data can be found in the file “servers.csv”. Servers' selling prices are stored in the file “selling_prices.csv”.

Attribute | Explanation | Variable
--- | --- | ---
Server ID | This is a unique ID related to each server. | s
Server Generation | As technology advances, new servers are available for purchase at certain time-steps. This is the unique ID of a generation of servers. There are four generations of CPU servers, and three generations of GPU servers. | g
Server Type | The server type can be: CPU or GPU. | 
Capacity | The capacity has a different unit of measurement for each server type. CPU servers capacity is measured in number of CPUs; GPU servers capacity is measured in number of GPU cards. | z
Release Time | Time-steps at which the server is available for purchase. | 
Purchase Price | This is the server price. | r
Slots Size | This is the number of slots occupied by the server. | v
Energy Consumption | This is the server energy consumption in terms of kilowatt per time-step. | ê
Cost of Moving | This is the cost required to move a server from one data-center to another. | m
Operating Time | This is the number of time-steps since the server has been deployed. | x
Life Expectancy | This is the maximum number of time-steps that the server can be used before to be dismissed. | x̂
Selling Price | This is the selling price for each unit of measurement of a given server generation. | p

## Objectives (Eq. 1):
At each time-step, the decision-maker wants to maximize the objective function defined in Eq. 1. This function consists of three sub-objectives: the servers' utilization $U$ (Eq. 2), the normalized servers' lifespan $L$ (Eq. 3), and the profit $P$ (Eq. 4).

$$
O = U \times L \times P
$$

## The servers' utilization (U) (Eq. 2):
The servers' utilization $U$. This is defined in Eq. 2 as the ratio of the demand
$D_{i, g}$ for a certain latency sensitivity $i$ and server generation g to the capacity $Z_{i, g}$
deployed to satisfy such demand. As the demand could be higher than the capac-
ity (and vice versa), in the numerator we use the met demand $min(Z_{i, g}^f , D_{i, g})$. i,g
Here, $f$ represents the failure rate that is sampled from a truncated Weibull distribution with $f \in [0.05,0.1]$. Specifically, the capacity $Z_{i, g}^f$ is equal to the sum of
the capacities of all servers of generation $g$ deployed across all datacenters with latency sensitivity $i$ adjusted by the failure rate $f$ as follows:

$$
Z_{i, g}^f = (1 − f) \times Z_{i, g}
$$

Also, servers' utilization is averaged across the total number of latency sensitivity and server generation pairs $|I \times G|$. Finally, it should be noted that, at each timestep $t$, the demand is stochastic as outlined in Eq. 2.1.

$$
U = \frac{1}{{|I \times G|}} \sum_{i \in I} \sum_{g \in G} \frac{{\min(Z_{i,g}^{f}, D_{i,g})}}{{Z_{i,g}^{f}}}
$$

Where

### Demand (Eq. 2.1):
At every time-step, there is a certain demand for each pair of latency sensitivity $i$ and server generation $g$. Such demand is computed by the “get_actual_demand” function provided in the “evaluation.py” file.

$$
D_{i,g,t} = D_{i,g,t-1} + N
$$

## Servers' Normalized Lifespan (L) (Eq. 3):
The servers' normalized lifespan $L$. This is defined in Eq. 3, for all the servers of the fleet $S$, as the ratio of the operating time $x_s$, that is the number of time-steps since the server $s$ has been deployed, to $\hat{x_s}$, that is the server life expectancy. It should be noted that after $\hat{x_s}$ time-steps the server must be dismissed.

$$
L = \frac{1}{|S|} \times \sum_{s \in S} \frac{x_s}{\hat{x_s}}
$$

## Profit (P) (Eq. 4):
The profit $P$. This is defined in Eq. 4 as the difference between the revenue $R$ and the cost $C$.
$$ P = R - C $$

Where

### Revenue (Eq. 4.1):
The revenue $R$ is defined in Eq. 4.1 as the sum of the revenue generated by the capacity $Z_{i,g}^{f}$ deployed to satisfy the demand $D_{i,g}$ for a certain latency sensitivity $i$ and server generation $g$. The revenue equals the met demand $min(Z_{i, g}^f , D_{i, g})$ times the price $p_{i,g}$. As in Eq. 2, f represents the failure rate. Selling prices are stored in the file “selling_prices.csv”.

$$ 
R = \sum_{i \in I} \sum_{g \in G} \min(Z_{i,g}^{f}, D_{i,g}) \times p_{i,g}
$$

### Cost (Eq. 4.2):
The cost $C$ is defined in Eq. 4.2 as the sum of the cost all servers $S_k$ deployed across all data-centers $K$. The cost of a server is equal to the sum of the server purchase price $r_s$, the cost of the server energy consumption $e_s$, and the server maintenance cost $\alpha(·)$. If the server is moved from one data-center to another it is necessary to account for the moving cost $m$. The server energy consumption, as defined in Eq. 4.2.1, is equal to the product of the server energy consumption $\hat{e_s}$ times the cost of energy $h_k$ that is the cost of energy at the data-center $k$ where the server $s$ is deployed. Finally, the maintenance cost is calculated according to a function $\alpha(·)$ defined in Eq. 4.2.2. This function takes as input: the server operating time $x_s$, the server life expectancy $\hat{x_s}$, and average maintenance fee $b_s$.

$$
C = \sum_{k \in K} \sum_{s \in S_k}
\begin{cases}
r_s + e_s + \alpha(x_s) & \text{if } x_s = 1 \\
e_s + \alpha(x_s) + m & \text{if action = move} \\
e_s + \alpha(x_s) & \text{otherwise}
\end{cases}
$$

Where

#### Server Energy Consumption (Eq. 4.2.1):
$$
e_s = \hat{e_s} \times h_k
$$

#### Maintenance Cost Function (Eq. 4.2.2):
$$
\alpha(x_s) = b_s \times [1 + \frac{1.5x_s}{\hat{x_s}} \times \log_2(\frac{1.5x_s}{\hat{x_s}})]
$$

## Constraint Equation (Eq. 5):
Constraint: the number of slots. As defined in Eq. 5, the number of slots occupied at each data-center $k$ must be less than or equal to its slots capacity $V_k$. In this equation, $v_{s,k}$ represents the slots size of server $s$ deployed at the data-center $k$ while $S_k$ represents the set of servers deployed at date-center $k$.

$$
V_k \geq \sum_{s \in S_k} v_{s,k} \quad \forall k
$$

## Actions:
At each time-step, the decision-maker can take four actions to maximize the objective function. These actions are detailed in Table 3. Again, at each time-step the decision-maker can take as many actions as needed. As an example, at time-step 1 the decision-maker may choose to buy 50 CPU servers for data-center 1 and 10 GPU servers for data-center 2.

## Timeline:
Timeline. The timeline consists of 168 discrete time-steps. At time-step 0 data-centers are empty.

## Solution Evaluation (Eq. 6):
Solutions are evaluated according to the cumulative score achieved through Eq. 6 over all the time-steps $T$. Solutions that violate the constraint are discarded.

$$
O = \sum_{t = 1}^{T} U_t \times L_t \times P_t
$$

